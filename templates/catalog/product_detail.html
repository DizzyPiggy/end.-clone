{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="max-w-[1920px] mx-auto px-6 py-12">
    <!-- Breadcrumbs -->
    <div class="max-w-7xl mx-auto text-xs text-gray-500 mb-8 flex items-center">
        <span><a href="{% url 'product_list' %}">Catalog</a></span>
        <span class="mx-2">›</span>
        <span>{{ product.category.name|default:"Product" }}</span>
        <span class="mx-2">›</span>
        <span>{{ product.name }}</span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-24 max-w-7xl mx-auto">
        <!-- Left: Gallery (Thumbnails + Main Images) -->
        <div class="lg:col-span-7 flex gap-4">
            <!-- Thumbnails (Hidden on mobile, sticky on desktop) -->
            <div class="hidden lg:flex flex-col gap-[3px] sticky h-fit w-16 flex-shrink-0 transition-[top] duration-300"
                :class="headerVisible ? 'top-28' : 'top-0'">
                {% if product.image %}
                <a href="#img-main"
                    class="block aspect-[3/4] border border-transparent hover:border-black transition-colors bg-white">
                    <img src="{{ product.image.url }}" class="w-full h-full object-contain" alt="Thumbnail Main" />
                </a>
                {% endif %}
                {% for img in product.gallery_images.all %}
                <a href="#img-{{ forloop.counter }}"
                    class="block aspect-[3/4] border border-transparent hover:border-black transition-colors bg-white">
                    <img src="{{ img.image.url }}" class="w-full h-full object-contain"
                        alt="Thumbnail {{ forloop.counter }}" onerror="this.parentElement.style.display='none'" />
                </a>
                {% endfor %}
            </div>

            <!-- Main Images Stack -->
            <div class="flex-grow flex flex-col gap-[3px]">
                {% if product.image %}
                <div id="img-main" class="w-full">
                    <img src="{{ product.image.url }}" class="w-full h-auto block" alt="{{ product.name }}" />
                </div>
                {% endif %}
                {% for img in product.gallery_images.all %}
                <div id="img-{{ forloop.counter }}" class="w-full">
                    <img src="{{ img.image.url }}" class="w-full h-auto block"
                        alt="{{ product.name }} {{ forloop.counter }}"
                        onerror="this.parentElement.style.display='none'" />
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Right: Product Info -->
        <div class="lg:col-span-5 sticky h-fit transition-[top] duration-300"
            :class="headerVisible ? 'top-28' : 'top-0'"
            x-data="{ selectedSize: null }">
            <div class="sticky top-32 text-center px-8">
                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-2xl font-bold tracking-widest uppercase mb-2">{{ product.name }}</h1>
                    {% if product.color %}
                    <p class="text-sm text-gray-500 mb-2">{{ product.color }}</p>
                    {% endif %}
                    <p class="text-base font-bold text-black">${{ product.price }}</p>
                </div>

                <!-- Size Selection -->
                <div class="mb-8 text-left">
                    <div class="flex justify-between text-sm mb-3">
                        <span class="text-gray-500" x-text="selectedSize ? selectedSize : 'Select a size'">Select a size</span>
                        <span class="underline cursor-pointer">Size guide</span>
                    </div>
                    {% if product.sizes.exists %}
                    <div class="grid grid-cols-4 gap-2">
                        {% for p_size in product.sizes.all %}
                        <button
                            class="size-btn py-3 text-xs font-bold tracking-wider border"
                            :class="selectedSize === '{{ p_size.size }}' ? 'border-black bg-white text-black ring-1 ring-black' : 'border-gray-200 text-gray-500 hover:border-gray-400'"
                            @click="selectedSize = '{{ p_size.size }}'">{{ p_size.size }}</button>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="w-full py-3 border border-gray-200 text-center text-sm text-black font-medium">
                        One Size
                    </div>
                    {% endif %}
                </div>

                <!-- Delivery Info -->
                <div class="text-xs text-gray-600 mb-6 font-light">
                    <p class="mb-1"><span class="font-medium text-green-700">Order now</span> to receive Fri 09 Jan -
                        Mon 12 Jan.</p>
                    <p>We cover Import Duties - no hidden fees at checkout.</p>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-3 mb-10">
                    <button @click="cartOpen = true"
                        class="w-full bg-[#1e1e1e] text-white py-4 text-sm font-bold tracking-[0.15em] hover:bg-black transition-colors">
                        ADD TO CART
                    </button>
                    <button
                        class="w-full bg-white border border-gray-200 text-black py-4 text-sm font-bold tracking-[0.15em] hover:bg-gray-50 transition-colors">
                        ADD TO WISHLIST
                    </button>
                </div>

                <!-- Tabs (Description, etc.) -->
                <div class="border-t border-gray-200" x-data="{ activeTab: 'description' }">
                    <div
                        class="flex justify-center gap-6 text-xs font-bold tracking-widest uppercase py-4 border-b border-gray-200">
                        <button @click="activeTab = 'description'"
                            :class="{ 'text-black border-b border-black pb-1': activeTab === 'description', 'text-gray-400': activeTab !== 'description' }">Description</button>
                        <button @click="activeTab = 'sizing'"
                            :class="{ 'text-black border-b border-black pb-1': activeTab === 'sizing', 'text-gray-400': activeTab !== 'sizing' }">Sizing</button>
                        <button @click="activeTab = 'shipping'"
                            :class="{ 'text-black border-b border-black pb-1': activeTab === 'shipping', 'text-gray-400': activeTab !== 'shipping' }">Shipping</button>
                        <button @click="activeTab = 'returns'"
                            :class="{ 'text-black border-b border-black pb-1': activeTab === 'returns', 'text-gray-400': activeTab !== 'returns' }">Returns</button>
                    </div>

                    <!-- Description Tab -->
                    <div x-show="activeTab === 'description'"
                        class="py-6 text-sm text-left font-light text-gray-600 space-y-4 leading-relaxed"
                        x-transition.opacity>
                        <p>{{ product.description|linebreaks }}</p>
                        <ul class="list-disc pl-5 mt-4 space-y-1">
                            {% if product.clothing %}
                            <li>Material: {{ product.clothing.material }}</li>
                            {% endif %}
                            <li>Style Code: {{ product.id|stringformat:"05d" }}</li>
                        </ul>
                    </div>
                    <!-- Sizing Tab -->
                    <div x-show="activeTab === 'sizing'"
                        class="py-6 text-sm text-left font-light text-gray-600 space-y-4 leading-relaxed" x-clock
                        x-transition.opacity>
                        <p>Fits true to size. We recommend taking your normal size.</p>
                        <p>Model is 6ft 1in/1.85m with a 36"/91.4cm chest and wears a size Medium.</p>
                    </div>

                    <!-- Shipping Tab -->
                    <div x-show="activeTab === 'shipping'"
                        class="py-6 text-sm text-left font-light text-gray-600 space-y-4 leading-relaxed" x-clock
                        x-transition.opacity>
                        <p>Free shipping on orders over $200.</p>
                        <p>Standard delivery: 3-5 working days.</p>
                        <p>Express delivery: 1-2 working days.</p>
                    </div>

                    <!-- Returns Tab -->
                    <div x-show="activeTab === 'returns'"
                        class="py-6 text-sm text-left font-light text-gray-600 space-y-4 leading-relaxed" x-clock
                        x-transition.opacity>
                        <p>If you are not satisfied with your order, you can return it within 14 days of receipt.</p>
                        <p>Items must be returned in their original condition and packaging.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
    <div class="mt-24 pt-12 border-t border-gray-100">
        <h3 class="text-xl font-medium tracking-widest uppercase mb-8">You Might Also Like</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {% for product in related_products %}
            <a href="{% url 'product_detail' product.id %}" class="group block cursor-pointer">
                <div class="relative aspect-[3/4] overflow-hidden mb-4">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}"
                        class="w-full h-full object-contain object-center group-hover:scale-105 transition-transform duration-500"
                        loading="lazy">
                    {% elif product.gallery_images.first %}
                    <img src="{{ product.gallery_images.first.image.url }}" alt="{{ product.name }}"
                        class="w-full h-full object-contain object-center group-hover:scale-105 transition-transform duration-500"
                        loading="lazy">
                    {% else %}
                    <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs">No
                        Image</div>
                    {% endif %}
                </div>
                <div class="space-y-1">
                    <p class="text-sm text-gray-900 font-light leading-tight">{{ product.name }}</p>
                    <p class="text-xs text-gray-500 font-light">{{ product.color|default:"" }}</p>
                    <p class="text-sm font-normal text-gray-900 mt-2">${{ product.price }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>


{% endblock %}